import e from"jszip";function getDOMParser(){return window.rawWindow&&window.rawWindow.DOMParser?window.rawWindow.DOMParser:window.DOMParser}function parseRelationships(e,t){return t.elements(e).map(e=>({id:t.attr(e,"Id"),type:t.attr(e,"Type"),target:t.attr(e,"Target"),targetMode:t.attr(e,"TargetMode")}))}!function(e){e.OfficeDocument="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",e.FontTable="http://schemas.openxmlformats.org/officeDocument/2006/relationships/fontTable",e.Image="http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",e.Numbering="http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering",e.Styles="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",e.StylesWithEffects="http://schemas.microsoft.com/office/2007/relationships/stylesWithEffects",e.Theme="http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",e.Settings="http://schemas.openxmlformats.org/officeDocument/2006/relationships/settings",e.WebSettings="http://schemas.openxmlformats.org/officeDocument/2006/relationships/webSettings",e.Hyperlink="http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",e.Footnotes="http://schemas.openxmlformats.org/officeDocument/2006/relationships/footnotes",e.Endnotes="http://schemas.openxmlformats.org/officeDocument/2006/relationships/endnotes",e.Footer="http://schemas.openxmlformats.org/officeDocument/2006/relationships/footer",e.Header="http://schemas.openxmlformats.org/officeDocument/2006/relationships/header",e.ExtendedProperties="http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",e.CoreProperties="http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",e.CustomProperties="http://schemas.openxmlformats.org/package/2006/relationships/metadata/custom-properties"}(RelationshipTypes||(RelationshipTypes={}));let ns$1={wordml:"http://schemas.openxmlformats.org/wordprocessingml/2006/main",drawingml:"http://schemas.openxmlformats.org/drawingml/2006/main",picture:"http://schemas.openxmlformats.org/drawingml/2006/picture",compatibility:"http://schemas.openxmlformats.org/markup-compatibility/2006",math:"http://schemas.openxmlformats.org/officeDocument/2006/math"},LengthUsage={Dxa:{mul:.05,unit:"pt"},Emu:{mul:1/12700,unit:"pt"},FontSize:{mul:.5,unit:"pt"},Border:{mul:.125,unit:"pt"},Point:{mul:1,unit:"pt"},Percent:{mul:.02,unit:"%"},LineHeight:{mul:1/240,unit:""},VmlEmu:{mul:1/12700,unit:""}};function convertLength(e,t=LengthUsage.Dxa){return null==e||/.+(p[xt]|[%])$/.test(e)?e:`${(parseInt(e)*t.mul).toFixed(2)}${t.unit}`}function convertBoolean(e,t=!1){switch(e){case"1":case"on":case"true":return!0;case"0":case"off":case"false":return!1;default:return t}}function parseCommonProperty(e,t,r){if(e.namespaceURI!=ns$1.wordml)return!1;switch(e.localName){case"color":t.color=r.attr(e,"val");break;case"sz":t.fontSize=r.lengthAttr(e,"val",LengthUsage.FontSize);break;default:return!1}return!0}function parseXmlString(e,t=!1){t&&(e=e.replace(/<[?].*[?]>/,"")),e=removeUTF8BOM(e);let r=getDOMParser(),a=new r().parseFromString(e,"application/xml"),s=hasXmlParserError(a);if(s)throw Error(s);return a}function hasXmlParserError(e){return e.getElementsByTagName("parsererror")[0]?.textContent}function removeUTF8BOM(e){return 65279===e.charCodeAt(0)?e.substring(1):e}function serializeXmlString(e){return new XMLSerializer().serializeToString(e)}class XmlParser{elements(e,t=null){let r=[];for(let a=0,s=e.childNodes.length;a<s;a++){let l=e.childNodes.item(a);1==l.nodeType&&(null==t||l.localName==t)&&r.push(l)}return r}element(e,t){for(let r=0,a=e.childNodes.length;r<a;r++){let s=e.childNodes.item(r);if(1==s.nodeType&&s.localName==t)return s}return null}elementAttr(e,t,r){var a=this.element(e,t);return a?this.attr(a,r):void 0}attrs(e){return Array.from(e.attributes)}attr(e,t){for(let r=0,a=e.attributes.length;r<a;r++){let s=e.attributes.item(r);if(s.localName==t)return s.value}return null}intAttr(e,t,r=null){var a=this.attr(e,t);return a?parseInt(a):r}hexAttr(e,t,r=null){var a=this.attr(e,t);return a?parseInt(a,16):r}floatAttr(e,t,r=null){var a=this.attr(e,t);return a?parseFloat(a):r}boolAttr(e,t,r=null){return convertBoolean(this.attr(e,t),r)}lengthAttr(e,t,r=LengthUsage.Dxa){return convertLength(this.attr(e,t),r)}}let globalXmlParser=new XmlParser;class Part{constructor(e,t){this._package=e,this.path=t}async load(){this.rels=await this._package.loadRelationships(this.path);let e=await this._package.load(this.path),t=this._package.parseXmlDocument(e);this._package.options.keepOrigin&&(this._xmlDocument=t),this.parseXml(t.firstElementChild)}save(){this._package.update(this.path,serializeXmlString(this._xmlDocument))}parseXml(e){}}let embedFontTypeMap={embedRegular:"regular",embedBold:"bold",embedItalic:"italic",embedBoldItalic:"boldItalic"};function parseFonts(e,t){return t.elements(e).map(e=>parseFont(e,t))}function parseFont(e,t){let r={name:t.attr(e,"name"),embedFontRefs:[]};for(let a of t.elements(e))switch(a.localName){case"family":r.family=t.attr(a,"val");break;case"altName":r.altName=t.attr(a,"val");break;case"embedRegular":case"embedBold":case"embedItalic":case"embedBoldItalic":r.embedFontRefs.push(parseEmbedFontRef(a,t))}return r}function parseEmbedFontRef(e,t){return{id:t.attr(e,"id"),key:t.attr(e,"fontKey"),type:embedFontTypeMap[e.localName]}}class FontTablePart extends Part{parseXml(e){this.fonts=parseFonts(e,this._package.xmlParser)}}function escapeClassName(e){return e?.replace(/[ .]+/g,"-").replace(/[&]+/g,"and").toLowerCase()}function splitPath(e){let t=e.lastIndexOf("/")+1,r=0==t?"":e.substring(0,t),a=0==t?e:e.substring(t);return[r,a]}function resolvePath(e,t){try{let r="http://docx/",a=new URL(e,r+t).toString();return a.substring(r.length)}catch{return`${t}${e}`}}function keyBy(e,t){return e.reduce((e,r)=>(e[t(r)]=r,e),{})}function blobToBase64(e){return new Promise((t,r)=>{let a=new FileReader;a.onloadend=()=>t(a.result),a.onerror=()=>r(),a.readAsDataURL(e)})}function isObject(e){return e&&"object"==typeof e&&!Array.isArray(e)}function isString(e){return"string"==typeof e||e instanceof String}function mergeDeep(e,...t){if(!t.length)return e;let r=t.shift();if(isObject(e)&&isObject(r))for(let a in r)if(isObject(r[a])){let s=e[a]??(e[a]={});mergeDeep(s,r[a])}else e[a]=r[a];return mergeDeep(e,...t)}function asArray(e){return Array.isArray(e)?e:[e]}class OpenXmlPackage{constructor(e,t){this._zip=e,this.options=t,this.xmlParser=new XmlParser}get(e){return this._zip.files[normalizePath(e)]}update(e,t){this._zip.file(e,t)}static async load(t,r){let a=await e.loadAsync(t);return new OpenXmlPackage(a,r)}save(e="blob"){return this._zip.generateAsync({type:e})}load(e,t="string"){return this.get(e)?.async(t)??Promise.resolve(null)}async loadRelationships(e=null){let t="_rels/.rels";if(null!=e){let[r,a]=splitPath(e);t=`${r}_rels/${a}.rels`}let s=await this.load(t);return s?parseRelationships(this.parseXmlDocument(s).firstElementChild,this.xmlParser):null}parseXmlDocument(e){return parseXmlString(e,this.options.trimXmlDeclaration)}}function normalizePath(e){return e.startsWith("/")?e.substr(1):e}class DocumentPart extends Part{constructor(e,t,r){super(e,t),this._documentParser=r}parseXml(e){this.body=this._documentParser.parseDocumentFile(e)}}function parseBorder(e,t){return{type:t.attr(e,"val"),color:t.attr(e,"color"),size:t.lengthAttr(e,"sz",LengthUsage.Border),offset:t.lengthAttr(e,"space",LengthUsage.Point),frame:t.boolAttr(e,"frame"),shadow:t.boolAttr(e,"shadow")}}function parseBorders(e,t){var r={};for(let a of t.elements(e))switch(a.localName){case"left":r.left=parseBorder(a,t);break;case"top":r.top=parseBorder(a,t);break;case"right":r.right=parseBorder(a,t);break;case"bottom":r.bottom=parseBorder(a,t)}return r}function parseSectionProperties(e,t=globalXmlParser){var r={};for(let a of t.elements(e))switch(a.localName){case"pgSz":r.pageSize={width:t.lengthAttr(a,"w"),height:t.lengthAttr(a,"h"),orientation:t.attr(a,"orient")};break;case"type":r.type=t.attr(a,"val");break;case"pgMar":r.pageMargins={left:t.lengthAttr(a,"left"),right:t.lengthAttr(a,"right"),top:t.lengthAttr(a,"top"),bottom:t.lengthAttr(a,"bottom"),header:t.lengthAttr(a,"header"),footer:t.lengthAttr(a,"footer"),gutter:t.lengthAttr(a,"gutter")};break;case"cols":r.columns=parseColumns(a,t);break;case"headerReference":(r.headerRefs??(r.headerRefs=[])).push(parseFooterHeaderReference(a,t));break;case"footerReference":(r.footerRefs??(r.footerRefs=[])).push(parseFooterHeaderReference(a,t));break;case"titlePg":r.titlePage=t.boolAttr(a,"val",!0);break;case"pgBorders":r.pageBorders=parseBorders(a,t);break;case"pgNumType":r.pageNumber=parsePageNumber(a,t)}return r}function parseColumns(e,t){return{numberOfColumns:t.intAttr(e,"num"),space:t.lengthAttr(e,"space"),separator:t.boolAttr(e,"sep"),equalWidth:t.boolAttr(e,"equalWidth",!0),columns:t.elements(e,"col").map(e=>({width:t.lengthAttr(e,"w"),space:t.lengthAttr(e,"space")}))}}function parsePageNumber(e,t){return{chapSep:t.attr(e,"chapSep"),chapStyle:t.attr(e,"chapStyle"),format:t.attr(e,"fmt"),start:t.intAttr(e,"start")}}function parseFooterHeaderReference(e,t){return{id:t.attr(e,"id"),type:t.attr(e,"type")}}function parseLineSpacing(e,t){return{before:t.lengthAttr(e,"before"),after:t.lengthAttr(e,"after"),line:t.intAttr(e,"line"),lineRule:t.attr(e,"lineRule")}}function parseRunProperties(e,t){let r={};for(let a of t.elements(e))parseRunProperty(a,r,t);return r}function parseRunProperty(e,t,r){return!!parseCommonProperty(e,t,r)}function parseParagraphProperties(e,t){let r={};for(let a of t.elements(e))parseParagraphProperty(a,r,t);return r}function parseParagraphProperty(e,t,r){if(e.namespaceURI!=ns$1.wordml)return!1;if(parseCommonProperty(e,t,r))return!0;switch(e.localName){case"tabs":t.tabs=parseTabs(e,r);break;case"sectPr":t.sectionProps=parseSectionProperties(e,r);break;case"numPr":t.numbering=parseNumbering$1(e,r);break;case"spacing":return t.lineSpacing=parseLineSpacing(e,r),!1;case"textAlignment":return t.textAlignment=r.attr(e,"val"),!1;case"keepLines":t.keepLines=r.boolAttr(e,"val",!0);break;case"keepNext":t.keepNext=r.boolAttr(e,"val",!0);break;case"pageBreakBefore":t.pageBreakBefore=r.boolAttr(e,"val",!0);break;case"outlineLvl":t.outlineLevel=r.intAttr(e,"val");break;case"pStyle":t.styleName=r.attr(e,"val");break;case"rPr":t.runProps=parseRunProperties(e,r);break;default:return!1}return!0}function parseTabs(e,t){return t.elements(e,"tab").map(e=>({position:t.lengthAttr(e,"pos"),leader:t.attr(e,"leader"),style:t.attr(e,"val")}))}function parseNumbering$1(e,t){var r={};for(let a of t.elements(e))switch(a.localName){case"numId":r.id=t.attr(a,"val");break;case"ilvl":r.level=t.intAttr(a,"val")}return r}function parseNumberingPart(e,t){let r={numberings:[],abstractNumberings:[],bulletPictures:[]};for(let a of t.elements(e))switch(a.localName){case"num":r.numberings.push(parseNumbering(a,t));break;case"abstractNum":r.abstractNumberings.push(parseAbstractNumbering(a,t));break;case"numPicBullet":r.bulletPictures.push(parseNumberingBulletPicture(a,t))}return r}function parseNumbering(e,t){let r={id:t.attr(e,"numId"),overrides:[]};for(let a of t.elements(e))switch(a.localName){case"abstractNumId":r.abstractId=t.attr(a,"val");break;case"lvlOverride":r.overrides.push(parseNumberingLevelOverrride(a,t))}return r}function parseAbstractNumbering(e,t){let r={id:t.attr(e,"abstractNumId"),levels:[]};for(let a of t.elements(e))switch(a.localName){case"name":r.name=t.attr(a,"val");break;case"multiLevelType":r.multiLevelType=t.attr(a,"val");break;case"numStyleLink":r.numberingStyleLink=t.attr(a,"val");break;case"styleLink":r.styleLink=t.attr(a,"val");break;case"lvl":r.levels.push(parseNumberingLevel(a,t))}return r}function parseNumberingLevel(e,t){let r={level:t.intAttr(e,"ilvl")};for(let a of t.elements(e))switch(a.localName){case"start":r.start=t.attr(a,"val");break;case"lvlRestart":r.restart=t.intAttr(a,"val");break;case"numFmt":r.format=t.attr(a,"val");break;case"lvlText":r.text=t.attr(a,"val");break;case"lvlJc":r.justification=t.attr(a,"val");break;case"lvlPicBulletId":r.bulletPictureId=t.attr(a,"val");break;case"pStyle":r.paragraphStyle=t.attr(a,"val");break;case"pPr":r.paragraphProps=parseParagraphProperties(a,t);break;case"rPr":r.runProps=parseRunProperties(a,t)}return r}function parseNumberingLevelOverrride(e,t){let r={level:t.intAttr(e,"ilvl")};for(let a of t.elements(e))switch(a.localName){case"startOverride":r.start=t.intAttr(a,"val");break;case"lvl":r.numberingLevel=parseNumberingLevel(a,t)}return r}function parseNumberingBulletPicture(e,t){var r=t.element(e,"pict"),a=r&&t.element(r,"shape"),s=a&&t.element(a,"imagedata");return s?{id:t.attr(e,"numPicBulletId"),referenceId:t.attr(s,"id"),style:t.attr(a,"style")}:null}!function(e){e.Continuous="continuous",e.NextPage="nextPage",e.NextColumn="nextColumn",e.EvenPage="evenPage",e.OddPage="oddPage"}(SectionType||(SectionType={}));class NumberingPart extends Part{constructor(e,t,r){super(e,t),this._documentParser=r}parseXml(e){Object.assign(this,parseNumberingPart(e,this._package.xmlParser)),this.domNumberings=this._documentParser.parseNumberingFile(e)}}class StylesPart extends Part{constructor(e,t,r){super(e,t),this._documentParser=r}parseXml(e){this.styles=this._documentParser.parseStylesFile(e)}}!function(e){e.Document="document",e.Paragraph="paragraph",e.Run="run",e.Break="break",e.NoBreakHyphen="noBreakHyphen",e.Table="table",e.Row="row",e.Cell="cell",e.Hyperlink="hyperlink",e.Drawing="drawing",e.Image="image",e.Text="text",e.Tab="tab",e.Symbol="symbol",e.BookmarkStart="bookmarkStart",e.BookmarkEnd="bookmarkEnd",e.Footer="footer",e.Header="header",e.FootnoteReference="footnoteReference",e.EndnoteReference="endnoteReference",e.Footnote="footnote",e.Endnote="endnote",e.SimpleField="simpleField",e.ComplexField="complexField",e.Instruction="instruction",e.VmlPicture="vmlPicture",e.MmlMath="mmlMath",e.MmlMathParagraph="mmlMathParagraph",e.MmlFraction="mmlFraction",e.MmlFunction="mmlFunction",e.MmlFunctionName="mmlFunctionName",e.MmlNumerator="mmlNumerator",e.MmlDenominator="mmlDenominator",e.MmlRadical="mmlRadical",e.MmlBase="mmlBase",e.MmlDegree="mmlDegree",e.MmlSuperscript="mmlSuperscript",e.MmlSubscript="mmlSubscript",e.MmlPreSubSuper="mmlPreSubSuper",e.MmlSubArgument="mmlSubArgument",e.MmlSuperArgument="mmlSuperArgument",e.MmlNary="mmlNary",e.MmlDelimiter="mmlDelimiter",e.MmlRun="mmlRun",e.MmlEquationArray="mmlEquationArray",e.MmlLimit="mmlLimit",e.MmlLimitLower="mmlLimitLower",e.MmlMatrix="mmlMatrix",e.MmlMatrixRow="mmlMatrixRow",e.MmlBox="mmlBox",e.MmlBar="mmlBar",e.MmlGroupChar="mmlGroupChar",e.VmlElement="vmlElement",e.Inserted="inserted",e.Deleted="deleted",e.DeletedText="deletedText"}(DomType||(DomType={}));class OpenXmlElementBase{constructor(){this.children=[],this.cssStyle={}}}class WmlHeader extends OpenXmlElementBase{constructor(){super(...arguments),this.type=DomType.Header}}class WmlFooter extends OpenXmlElementBase{constructor(){super(...arguments),this.type=DomType.Footer}}class BaseHeaderFooterPart extends Part{constructor(e,t,r){super(e,t),this._documentParser=r}parseXml(e){this.rootElement=this.createRootElement(),this.rootElement.children=this._documentParser.parseBodyElements(e)}}class HeaderPart extends BaseHeaderFooterPart{createRootElement(){return new WmlHeader}}class FooterPart extends BaseHeaderFooterPart{createRootElement(){return new WmlFooter}}function parseExtendedProps(e,t){let r={};for(let a of t.elements(e))switch(a.localName){case"Template":r.template=a.textContent;break;case"Pages":r.pages=safeParseToInt(a.textContent);break;case"Words":r.words=safeParseToInt(a.textContent);break;case"Characters":r.characters=safeParseToInt(a.textContent);break;case"Application":r.application=a.textContent;break;case"Lines":r.lines=safeParseToInt(a.textContent);break;case"Paragraphs":r.paragraphs=safeParseToInt(a.textContent);break;case"Company":r.company=a.textContent;break;case"AppVersion":r.appVersion=a.textContent}return r}function safeParseToInt(e){if(void 0!==e)return parseInt(e)}class ExtendedPropsPart extends Part{parseXml(e){this.props=parseExtendedProps(e,this._package.xmlParser)}}function parseCoreProps(e,t){let r={};for(let a of t.elements(e))switch(a.localName){case"title":r.title=a.textContent;break;case"description":r.description=a.textContent;break;case"subject":r.subject=a.textContent;break;case"creator":r.creator=a.textContent;break;case"keywords":r.keywords=a.textContent;break;case"language":r.language=a.textContent;break;case"lastModifiedBy":r.lastModifiedBy=a.textContent;break;case"revision":a.textContent&&(r.revision=parseInt(a.textContent))}return r}class CorePropsPart extends Part{parseXml(e){this.props=parseCoreProps(e,this._package.xmlParser)}}class DmlTheme{}function parseTheme(e,t){var r=new DmlTheme,a=t.element(e,"themeElements");for(let s of t.elements(a))switch(s.localName){case"clrScheme":r.colorScheme=parseColorScheme(s,t);break;case"fontScheme":r.fontScheme=parseFontScheme(s,t)}return r}function parseColorScheme(e,t){var r={name:t.attr(e,"name"),colors:{}};for(let a of t.elements(e)){var s=t.element(a,"srgbClr"),l=t.element(a,"sysClr");s?r.colors[a.localName]=t.attr(s,"val"):l&&(r.colors[a.localName]=t.attr(l,"lastClr"))}return r}function parseFontScheme(e,t){var r={name:t.attr(e,"name")};for(let a of t.elements(e))switch(a.localName){case"majorFont":r.majorFont=parseFontInfo(a,t);break;case"minorFont":r.minorFont=parseFontInfo(a,t)}return r}function parseFontInfo(e,t){return{latinTypeface:t.elementAttr(e,"latin","typeface"),eaTypeface:t.elementAttr(e,"ea","typeface"),csTypeface:t.elementAttr(e,"cs","typeface")}}class ThemePart extends Part{constructor(e,t){super(e,t)}parseXml(e){this.theme=parseTheme(e,this._package.xmlParser)}}class WmlBaseNote{}class WmlFootnote extends WmlBaseNote{constructor(){super(...arguments),this.type=DomType.Footnote}}class WmlEndnote extends WmlBaseNote{constructor(){super(...arguments),this.type=DomType.Endnote}}class BaseNotePart extends Part{constructor(e,t,r){super(e,t),this._documentParser=r}}class FootnotesPart extends BaseNotePart{constructor(e,t,r){super(e,t,r)}parseXml(e){this.notes=this._documentParser.parseNotes(e,"footnote",WmlFootnote)}}class EndnotesPart extends BaseNotePart{constructor(e,t,r){super(e,t,r)}parseXml(e){this.notes=this._documentParser.parseNotes(e,"endnote",WmlEndnote)}}function parseSettings(e,t){var r={};for(let a of t.elements(e))switch(a.localName){case"defaultTabStop":r.defaultTabStop=t.lengthAttr(a,"val");break;case"footnotePr":r.footnoteProps=parseNoteProperties(a,t);break;case"endnotePr":r.endnoteProps=parseNoteProperties(a,t);break;case"autoHyphenation":r.autoHyphenation=t.boolAttr(a,"val")}return r}function parseNoteProperties(e,t){var r={defaultNoteIds:[]};for(let a of t.elements(e))switch(a.localName){case"numFmt":r.nummeringFormat=t.attr(a,"val");break;case"footnote":case"endnote":r.defaultNoteIds.push(t.attr(a,"id"))}return r}class SettingsPart extends Part{constructor(e,t){super(e,t)}parseXml(e){this.settings=parseSettings(e,this._package.xmlParser)}}function parseCustomProps(e,t){return t.elements(e,"property").map(e=>{let r=e.firstChild;return{formatId:t.attr(e,"fmtid"),name:t.attr(e,"name"),type:r.nodeName,value:r.textContent}})}class CustomPropsPart extends Part{parseXml(e){this.props=parseCustomProps(e,this._package.xmlParser)}}let topLevelRels=[{type:RelationshipTypes.OfficeDocument,target:"word/document.xml"},{type:RelationshipTypes.ExtendedProperties,target:"docProps/app.xml"},{type:RelationshipTypes.CoreProperties,target:"docProps/core.xml"},{type:RelationshipTypes.CustomProperties,target:"docProps/custom.xml"}];class WordDocument{constructor(){this.parts=[],this.partsMap={}}static async load(e,t,r){var a=new WordDocument;return a._options=r,a._parser=t,a._package=await OpenXmlPackage.load(e,r),a.rels=await a._package.loadRelationships(),await Promise.all(topLevelRels.map(e=>{let t=a.rels.find(t=>t.type===e.type)??e;return a.loadRelationshipPart(t.target,t.type)})),a}save(e="blob"){return this._package.save(e)}async loadRelationshipPart(e,t){if(this.partsMap[e])return this.partsMap[e];if(!this._package.get(e))return null;let r=null;switch(t){case RelationshipTypes.OfficeDocument:this.documentPart=r=new DocumentPart(this._package,e,this._parser);break;case RelationshipTypes.FontTable:this.fontTablePart=r=new FontTablePart(this._package,e);break;case RelationshipTypes.Numbering:this.numberingPart=r=new NumberingPart(this._package,e,this._parser);break;case RelationshipTypes.Styles:this.stylesPart=r=new StylesPart(this._package,e,this._parser);break;case RelationshipTypes.Theme:this.themePart=r=new ThemePart(this._package,e);break;case RelationshipTypes.Footnotes:this.footnotesPart=r=new FootnotesPart(this._package,e,this._parser);break;case RelationshipTypes.Endnotes:this.endnotesPart=r=new EndnotesPart(this._package,e,this._parser);break;case RelationshipTypes.Footer:r=new FooterPart(this._package,e,this._parser);break;case RelationshipTypes.Header:r=new HeaderPart(this._package,e,this._parser);break;case RelationshipTypes.CoreProperties:this.corePropsPart=r=new CorePropsPart(this._package,e);break;case RelationshipTypes.ExtendedProperties:this.extendedPropsPart=r=new ExtendedPropsPart(this._package,e);break;case RelationshipTypes.CustomProperties:r=new CustomPropsPart(this._package,e);break;case RelationshipTypes.Settings:this.settingsPart=r=new SettingsPart(this._package,e)}if(null==r)return Promise.resolve(null);if(this.partsMap[e]=r,this.parts.push(r),await r.load(),r.rels?.length>0){let[a]=splitPath(r.path);await Promise.all(r.rels.map(e=>this.loadRelationshipPart(resolvePath(e.target,a),e.type)))}return r}async loadDocumentImage(e,t){let r=await this.loadResource(t??this.documentPart,e,"blob");return this.blobToURL(r)}async loadNumberingImage(e){let t=await this.loadResource(this.numberingPart,e,"blob");return this.blobToURL(t)}async loadFont(e,t){let r=await this.loadResource(this.fontTablePart,e,"uint8array");return r?this.blobToURL(new Blob([deobfuscate(r,t)])):r}blobToURL(e){return e?this._options.useBase64URL?blobToBase64(e):URL.createObjectURL(e):null}findPartByRelId(e,t=null){var r=(t.rels??this.rels).find(t=>t.id==e);let a=t?splitPath(t.path)[0]:"";return r?this.partsMap[resolvePath(r.target,a)]:null}getPathById(e,t){let r=e.rels.find(e=>e.id==t),[a]=splitPath(e.path);return r?resolvePath(r.target,a):null}loadResource(e,t,r){let a=this.getPathById(e,t);return a?this._package.load(a,r):Promise.resolve(null)}}function deobfuscate(e,t){let r=t.replace(/{|}|-/g,""),a=Array(16);for(let s=0;s<16;s++)a[16-s-1]=parseInt(r.substr(2*s,2),16);for(let l=0;l<32;l++)e[l]=e[l]^a[l%16];return e}function parseBookmarkStart(e,t){return{type:DomType.BookmarkStart,id:t.attr(e,"id"),name:t.attr(e,"name"),colFirst:t.intAttr(e,"colFirst"),colLast:t.intAttr(e,"colLast")}}function parseBookmarkEnd(e,t){return{type:DomType.BookmarkEnd,id:t.attr(e,"id")}}class VmlElement extends OpenXmlElementBase{constructor(){super(...arguments),this.type=DomType.VmlElement,this.attrs={}}}function parseVmlElement(e,t){var r=new VmlElement;switch(e.localName){case"rect":r.tagName="rect",Object.assign(r.attrs,{width:"100%",height:"100%"});break;case"oval":r.tagName="ellipse",Object.assign(r.attrs,{cx:"50%",cy:"50%",rx:"50%",ry:"50%"});break;case"line":r.tagName="line";break;case"shape":r.tagName="g";break;case"textbox":r.tagName="foreignObject",Object.assign(r.attrs,{width:"100%",height:"100%"});break;default:return null}for(let a of globalXmlParser.attrs(e))switch(a.localName){case"style":r.cssStyleText=a.value;break;case"fillcolor":r.attrs.fill=a.value;break;case"from":let[s,l]=parsePoint(a.value);Object.assign(r.attrs,{x1:s,y1:l});break;case"to":let[n,o]=parsePoint(a.value);Object.assign(r.attrs,{x2:n,y2:o})}for(let i of globalXmlParser.elements(e))switch(i.localName){case"stroke":Object.assign(r.attrs,parseStroke(i));break;case"fill":Object.assign(r.attrs,parseFill());break;case"imagedata":r.tagName="image",Object.assign(r.attrs,{width:"100%",height:"100%"}),r.imageHref={id:globalXmlParser.attr(i,"id"),title:globalXmlParser.attr(i,"title")};break;case"txbxContent":r.children.push(...t.parseBodyElements(i));break;default:let c=parseVmlElement(i,t);c&&r.children.push(c)}return r}function parseStroke(e){return{stroke:globalXmlParser.attr(e,"color"),"stroke-width":globalXmlParser.lengthAttr(e,"weight",LengthUsage.Emu)??"1px"}}function parseFill(e){return{}}function parsePoint(e){return e.split(",")}var RelationshipTypes,SectionType,DomType,autos={shd:"inherit",color:"black",borderColor:"black",highlight:"transparent"};let supportedNamespaceURIs=[],mmlTagMap={oMath:DomType.MmlMath,oMathPara:DomType.MmlMathParagraph,f:DomType.MmlFraction,func:DomType.MmlFunction,fName:DomType.MmlFunctionName,num:DomType.MmlNumerator,den:DomType.MmlDenominator,rad:DomType.MmlRadical,deg:DomType.MmlDegree,e:DomType.MmlBase,sSup:DomType.MmlSuperscript,sSub:DomType.MmlSubscript,sPre:DomType.MmlPreSubSuper,sup:DomType.MmlSuperArgument,sub:DomType.MmlSubArgument,d:DomType.MmlDelimiter,nary:DomType.MmlNary,eqArr:DomType.MmlEquationArray,lim:DomType.MmlLimit,limLow:DomType.MmlLimitLower,m:DomType.MmlMatrix,mr:DomType.MmlMatrixRow,box:DomType.MmlBox,bar:DomType.MmlBar,groupChr:DomType.MmlGroupChar};class DocumentParser{constructor(e){this.options={ignoreWidth:!1,debug:!1,...e}}parseNotes(e,t,r){var a=[];for(let s of globalXmlParser.elements(e,t)){let l=new r;l.id=globalXmlParser.attr(s,"id"),l.noteType=globalXmlParser.attr(s,"type"),l.children=this.parseBodyElements(s),a.push(l)}return a}parseDocumentFile(e){var t=globalXmlParser.element(e,"body"),r=globalXmlParser.element(e,"background"),a=globalXmlParser.element(t,"sectPr");return{type:DomType.Document,children:this.parseBodyElements(t),props:a?parseSectionProperties(a,globalXmlParser):{},cssStyle:r?this.parseBackground(r):{}}}parseBackground(e){var t={},r=xmlUtil.colorAttr(e,"color");return r&&(t["background-color"]=r),t}parseBodyElements(e){var t=[];for(let r of globalXmlParser.elements(e))switch(r.localName){case"p":t.push(this.parseParagraph(r));break;case"tbl":t.push(this.parseTable(r));break;case"sdt":t.push(...this.parseSdt(r,e=>this.parseBodyElements(e)))}return t}parseStylesFile(e){var t=[];return xmlUtil.foreach(e,e=>{switch(e.localName){case"style":t.push(this.parseStyle(e));break;case"docDefaults":t.push(this.parseDefaultStyles(e))}}),t}parseDefaultStyles(e){var t={id:null,name:null,target:null,basedOn:null,styles:[]};return xmlUtil.foreach(e,e=>{switch(e.localName){case"rPrDefault":var r=globalXmlParser.element(e,"rPr");r&&t.styles.push({target:"span",values:this.parseDefaultProperties(r,{})});break;case"pPrDefault":var a=globalXmlParser.element(e,"pPr");a&&t.styles.push({target:"p",values:this.parseDefaultProperties(a,{})})}}),t}parseStyle(e){var t={id:globalXmlParser.attr(e,"styleId"),isDefault:globalXmlParser.boolAttr(e,"default"),name:null,target:null,basedOn:null,styles:[],linked:null};switch(globalXmlParser.attr(e,"type")){case"paragraph":t.target="p";break;case"table":t.target="table";break;case"character":t.target="span"}return xmlUtil.foreach(e,e=>{switch(e.localName){case"basedOn":t.basedOn=globalXmlParser.attr(e,"val");break;case"name":t.name=globalXmlParser.attr(e,"val");break;case"link":t.linked=globalXmlParser.attr(e,"val");break;case"next":t.next=globalXmlParser.attr(e,"val");break;case"aliases":t.aliases=globalXmlParser.attr(e,"val").split(",");break;case"pPr":t.styles.push({target:"p",values:this.parseDefaultProperties(e,{})}),t.paragraphProps=parseParagraphProperties(e,globalXmlParser);break;case"rPr":t.styles.push({target:"span",values:this.parseDefaultProperties(e,{})}),t.runProps=parseRunProperties(e,globalXmlParser);break;case"tblPr":case"tcPr":t.styles.push({target:"td",values:this.parseDefaultProperties(e,{})});break;case"tblStylePr":for(let r of this.parseTableStyle(e))t.styles.push(r);break;case"rsid":case"qFormat":case"hidden":case"semiHidden":case"unhideWhenUsed":case"autoRedefine":case"uiPriority":break;default:this.options.debug&&console.warn(`DOCX: Unknown style element: ${e.localName}`)}}),t}parseTableStyle(e){var t=[],r=globalXmlParser.attr(e,"type"),a="",s="";switch(r){case"firstRow":s=".first-row",a="tr.first-row td";break;case"lastRow":s=".last-row",a="tr.last-row td";break;case"firstCol":s=".first-col",a="td.first-col";break;case"lastCol":s=".last-col",a="td.last-col";break;case"band1Vert":s=":not(.no-vband)",a="td.odd-col";break;case"band2Vert":s=":not(.no-vband)",a="td.even-col";break;case"band1Horz":s=":not(.no-hband)",a="tr.odd-row";break;case"band2Horz":s=":not(.no-hband)",a="tr.even-row";break;default:return[]}return xmlUtil.foreach(e,e=>{switch(e.localName){case"pPr":t.push({target:`${a} p`,mod:s,values:this.parseDefaultProperties(e,{})});break;case"rPr":t.push({target:`${a} span`,mod:s,values:this.parseDefaultProperties(e,{})});break;case"tblPr":case"tcPr":t.push({target:a,mod:s,values:this.parseDefaultProperties(e,{})})}}),t}parseNumberingFile(e){var t=[],r={},a=[];return xmlUtil.foreach(e,e=>{switch(e.localName){case"abstractNum":this.parseAbstractNumbering(e,a).forEach(e=>t.push(e));break;case"numPicBullet":a.push(this.parseNumberingPicBullet(e));break;case"num":var s=globalXmlParser.attr(e,"numId");r[globalXmlParser.elementAttr(e,"abstractNumId","val")]=s}}),t.forEach(e=>e.id=r[e.id]),t}parseNumberingPicBullet(e){var t=globalXmlParser.element(e,"pict"),r=t&&globalXmlParser.element(t,"shape"),a=r&&globalXmlParser.element(r,"imagedata");return a?{id:globalXmlParser.intAttr(e,"numPicBulletId"),src:globalXmlParser.attr(a,"id"),style:globalXmlParser.attr(r,"style")}:null}parseAbstractNumbering(e,t){var r=[],a=globalXmlParser.attr(e,"abstractNumId");return xmlUtil.foreach(e,e=>{"lvl"===e.localName&&r.push(this.parseNumberingLevel(a,e,t))}),r}parseNumberingLevel(e,t,r){var a={id:e,level:globalXmlParser.intAttr(t,"ilvl"),start:1,pStyleName:void 0,pStyle:{},rStyle:{},suff:"tab"};return xmlUtil.foreach(t,e=>{switch(e.localName){case"start":a.start=globalXmlParser.intAttr(e,"val");break;case"pPr":this.parseDefaultProperties(e,a.pStyle);break;case"rPr":this.parseDefaultProperties(e,a.rStyle);break;case"lvlPicBulletId":var t=globalXmlParser.intAttr(e,"val");a.bullet=r.find(e=>e.id==t);break;case"lvlText":a.levelText=globalXmlParser.attr(e,"val");break;case"pStyle":a.pStyleName=globalXmlParser.attr(e,"val");break;case"numFmt":a.format=globalXmlParser.attr(e,"val");break;case"suff":a.suff=globalXmlParser.attr(e,"val")}}),a}parseSdt(e,t){let r=globalXmlParser.element(e,"sdtContent");return r?t(r):[]}parseInserted(e,t){return{type:DomType.Inserted,children:t(e)?.children??[]}}parseDeleted(e,t){return{type:DomType.Deleted,children:t(e)?.children??[]}}parseParagraph(e){var t={type:DomType.Paragraph,children:[]};for(let r of globalXmlParser.elements(e))switch(r.localName){case"pPr":this.parseParagraphProperties(r,t);break;case"r":t.children.push(this.parseRun(r,t));break;case"hyperlink":t.children.push(this.parseHyperlink(r,t));break;case"bookmarkStart":t.children.push(parseBookmarkStart(r,globalXmlParser));break;case"bookmarkEnd":t.children.push(parseBookmarkEnd(r,globalXmlParser));break;case"oMath":case"oMathPara":t.children.push(this.parseMathElement(r));break;case"sdt":t.children.push(...this.parseSdt(r,e=>this.parseParagraph(e).children));break;case"ins":t.children.push(this.parseInserted(r,e=>this.parseParagraph(e)));break;case"del":t.children.push(this.parseDeleted(r,e=>this.parseParagraph(e)))}return t}parseParagraphProperties(e,t){this.parseDefaultProperties(e,t.cssStyle={},null,e=>{if(parseParagraphProperty(e,t,globalXmlParser))return!0;switch(e.localName){case"pStyle":t.styleName=globalXmlParser.attr(e,"val");break;case"cnfStyle":t.className=values.classNameOfCnfStyle(e);break;case"framePr":this.parseFrame(e,t);break;case"rPr":break;default:return!1}return!0})}parseFrame(e,t){"drop"==globalXmlParser.attr(e,"dropCap")&&(t.cssStyle.float="left")}parseHyperlink(e,t){var r={type:DomType.Hyperlink,parent:t,children:[]},a=globalXmlParser.attr(e,"anchor"),s=globalXmlParser.attr(e,"id");return a&&(r.href="#"+a),s&&(r.id=s),xmlUtil.foreach(e,e=>{"r"===e.localName&&r.children.push(this.parseRun(e,r))}),r}parseRun(e,t){var r={type:DomType.Run,parent:t,children:[]};return xmlUtil.foreach(e,e=>{switch((e=this.checkAlternateContent(e)).localName){case"t":r.children.push({type:DomType.Text,text:e.textContent});break;case"delText":r.children.push({type:DomType.DeletedText,text:e.textContent});break;case"fldSimple":r.children.push({type:DomType.SimpleField,instruction:globalXmlParser.attr(e,"instr"),lock:globalXmlParser.boolAttr(e,"lock",!1),dirty:globalXmlParser.boolAttr(e,"dirty",!1)});break;case"instrText":r.fieldRun=!0,r.children.push({type:DomType.Instruction,text:e.textContent});break;case"fldChar":r.fieldRun=!0,r.children.push({type:DomType.ComplexField,charType:globalXmlParser.attr(e,"fldCharType"),lock:globalXmlParser.boolAttr(e,"lock",!1),dirty:globalXmlParser.boolAttr(e,"dirty",!1)});break;case"noBreakHyphen":r.children.push({type:DomType.NoBreakHyphen});break;case"br":r.children.push({type:DomType.Break,break:globalXmlParser.attr(e,"type")||"textWrapping"});break;case"lastRenderedPageBreak":r.children.push({type:DomType.Break,break:"lastRenderedPageBreak"});break;case"sym":r.children.push({type:DomType.Symbol,font:globalXmlParser.attr(e,"font"),char:globalXmlParser.attr(e,"char")});break;case"tab":r.children.push({type:DomType.Tab});break;case"footnoteReference":r.children.push({type:DomType.FootnoteReference,id:globalXmlParser.attr(e,"id")});break;case"endnoteReference":r.children.push({type:DomType.EndnoteReference,id:globalXmlParser.attr(e,"id")});break;case"drawing":let t=this.parseDrawing(e);t&&(r.children=[t]);break;case"pict":r.children.push(this.parseVmlPicture(e));break;case"rPr":this.parseRunProperties(e,r)}}),r}parseMathElement(e){let t=`${e.localName}Pr`,r={type:mmlTagMap[e.localName],children:[]};for(let a of globalXmlParser.elements(e)){let s=mmlTagMap[a.localName];if(s)r.children.push(this.parseMathElement(a));else if("r"==a.localName){var l=this.parseRun(a);l.type=DomType.MmlRun,r.children.push(l)}else a.localName==t&&(r.props=this.parseMathProperies(a))}return r}parseMathProperies(e){let t={};for(let r of globalXmlParser.elements(e))switch(r.localName){case"chr":t.char=globalXmlParser.attr(r,"val");break;case"vertJc":t.verticalJustification=globalXmlParser.attr(r,"val");break;case"pos":t.position=globalXmlParser.attr(r,"val");break;case"degHide":t.hideDegree=globalXmlParser.boolAttr(r,"val");break;case"begChr":t.beginChar=globalXmlParser.attr(r,"val");break;case"endChr":t.endChar=globalXmlParser.attr(r,"val")}return t}parseRunProperties(e,t){this.parseDefaultProperties(e,t.cssStyle={},null,e=>{switch(e.localName){case"rStyle":t.styleName=globalXmlParser.attr(e,"val");break;case"vertAlign":t.verticalAlign=values.valueOfVertAlign(e,!0);break;default:return!1}return!0})}parseVmlPicture(e){let t={type:DomType.VmlPicture,children:[]};for(let r of globalXmlParser.elements(e)){let a=parseVmlElement(r,this);a&&t.children.push(a)}return t}checkAlternateContent(e){if("AlternateContent"!=e.localName)return e;var t=globalXmlParser.element(e,"Choice");if(t){var r=globalXmlParser.attr(t,"Requires"),a=e.lookupNamespaceURI(r);if(supportedNamespaceURIs.includes(a))return t.firstElementChild}return globalXmlParser.element(e,"Fallback")?.firstElementChild}parseDrawing(e){for(var t of globalXmlParser.elements(e))switch(t.localName){case"inline":case"anchor":return this.parseDrawingWrapper(t)}}parseDrawingWrapper(e){var t={type:DomType.Drawing,children:[],cssStyle:{}},r="anchor"==e.localName;let a=null,s=globalXmlParser.boolAttr(e,"simplePos"),l={relative:"page",align:"left",offset:"0"},n={relative:"page",align:"top",offset:"0"};for(var o of globalXmlParser.elements(e))switch(o.localName){case"simplePos":s&&(l.offset=globalXmlParser.lengthAttr(o,"x",LengthUsage.Emu),n.offset=globalXmlParser.lengthAttr(o,"y",LengthUsage.Emu));break;case"extent":t.cssStyle.width=globalXmlParser.lengthAttr(o,"cx",LengthUsage.Emu),t.cssStyle.height=globalXmlParser.lengthAttr(o,"cy",LengthUsage.Emu);break;case"positionH":case"positionV":if(!s){let i="positionH"==o.localName?l:n;var c=globalXmlParser.element(o,"align"),m=globalXmlParser.element(o,"posOffset");i.relative=globalXmlParser.attr(o,"relativeFrom")??i.relative,c&&(i.align=c.textContent),m&&(i.offset=xmlUtil.sizeValue(m,LengthUsage.Emu))}break;case"wrapTopAndBottom":a="wrapTopAndBottom";break;case"wrapNone":a="wrapNone";break;case"graphic":var p=this.parseGraphic(o);p&&t.children.push(p)}return"wrapTopAndBottom"==a?(t.cssStyle.display="block",l.align&&(t.cssStyle["text-align"]=l.align,t.cssStyle.width="100%")):"wrapNone"==a?(t.cssStyle.display="block",t.cssStyle.position="relative",t.cssStyle.width="0px",t.cssStyle.height="0px",l.offset&&(t.cssStyle.left=l.offset),n.offset&&(t.cssStyle.top=n.offset)):r&&("left"==l.align||"right"==l.align)&&(t.cssStyle.float=l.align),t}parseGraphic(e){var t=globalXmlParser.element(e,"graphicData");for(let r of globalXmlParser.elements(t))if("pic"===r.localName)return this.parsePicture(r);return null}parsePicture(e){var t={type:DomType.Image,src:"",cssStyle:{}},r=globalXmlParser.element(e,"blipFill"),a=globalXmlParser.element(r,"blip");t.src=globalXmlParser.attr(a,"embed");var s=globalXmlParser.element(e,"spPr"),l=globalXmlParser.element(s,"xfrm");for(var n of(t.cssStyle.position="relative",globalXmlParser.elements(l)))switch(n.localName){case"ext":t.cssStyle.width=globalXmlParser.lengthAttr(n,"cx",LengthUsage.Emu),t.cssStyle.height=globalXmlParser.lengthAttr(n,"cy",LengthUsage.Emu);break;case"off":t.cssStyle.left=globalXmlParser.lengthAttr(n,"x",LengthUsage.Emu),t.cssStyle.top=globalXmlParser.lengthAttr(n,"y",LengthUsage.Emu)}return t}parseTable(e){var t={type:DomType.Table,children:[]};return xmlUtil.foreach(e,e=>{switch(e.localName){case"tr":t.children.push(this.parseTableRow(e));break;case"tblGrid":t.columns=this.parseTableColumns(e);break;case"tblPr":this.parseTableProperties(e,t)}}),t}parseTableColumns(e){var t=[];return xmlUtil.foreach(e,e=>{"gridCol"===e.localName&&t.push({width:globalXmlParser.lengthAttr(e,"w")})}),t}parseTableProperties(e,t){switch(t.cssStyle={},t.cellStyle={},this.parseDefaultProperties(e,t.cssStyle,t.cellStyle,e=>{switch(e.localName){case"tblStyle":t.styleName=globalXmlParser.attr(e,"val");break;case"tblLook":t.className=values.classNameOftblLook(e);break;case"tblpPr":this.parseTablePosition(e,t);break;case"tblStyleColBandSize":t.colBandSize=globalXmlParser.intAttr(e,"val");break;case"tblStyleRowBandSize":t.rowBandSize=globalXmlParser.intAttr(e,"val");break;default:return!1}return!0}),t.cssStyle["text-align"]){case"center":delete t.cssStyle["text-align"],t.cssStyle["margin-left"]="auto",t.cssStyle["margin-right"]="auto";break;case"right":delete t.cssStyle["text-align"],t.cssStyle["margin-left"]="auto"}}parseTablePosition(e,t){var r=globalXmlParser.lengthAttr(e,"topFromText"),a=globalXmlParser.lengthAttr(e,"bottomFromText"),s=globalXmlParser.lengthAttr(e,"rightFromText"),l=globalXmlParser.lengthAttr(e,"leftFromText");t.cssStyle.float="left",t.cssStyle["margin-bottom"]=values.addSize(t.cssStyle["margin-bottom"],a),t.cssStyle["margin-left"]=values.addSize(t.cssStyle["margin-left"],l),t.cssStyle["margin-right"]=values.addSize(t.cssStyle["margin-right"],s),t.cssStyle["margin-top"]=values.addSize(t.cssStyle["margin-top"],r)}parseTableRow(e){var t={type:DomType.Row,children:[]};return xmlUtil.foreach(e,e=>{switch(e.localName){case"tc":t.children.push(this.parseTableCell(e));break;case"trPr":this.parseTableRowProperties(e,t)}}),t}parseTableRowProperties(e,t){t.cssStyle=this.parseDefaultProperties(e,{},null,e=>{switch(e.localName){case"cnfStyle":t.className=values.classNameOfCnfStyle(e);break;case"tblHeader":t.isHeader=globalXmlParser.boolAttr(e,"val");break;default:return!1}return!0})}parseTableCell(e){var t={type:DomType.Cell,children:[]};return xmlUtil.foreach(e,e=>{switch(e.localName){case"tbl":t.children.push(this.parseTable(e));break;case"p":t.children.push(this.parseParagraph(e));break;case"tcPr":this.parseTableCellProperties(e,t)}}),t}parseTableCellProperties(e,t){t.cssStyle=this.parseDefaultProperties(e,{},null,e=>{switch(e.localName){case"gridSpan":t.span=globalXmlParser.intAttr(e,"val",null);break;case"vMerge":t.verticalMerge=globalXmlParser.attr(e,"val")??"continue";break;case"cnfStyle":t.className=values.classNameOfCnfStyle(e);break;default:return!1}return!0})}parseDefaultProperties(e,t=null,r=null,a=null){return t=t||{},xmlUtil.foreach(e,s=>{if(!a?.(s))switch(s.localName){case"jc":t["text-align"]=values.valueOfJc(s);break;case"textAlignment":t["vertical-align"]=values.valueOfTextAlignment(s);break;case"color":t.color=xmlUtil.colorAttr(s,"val",null,autos.color);break;case"sz":t["font-size"]=t["min-height"]=globalXmlParser.lengthAttr(s,"val",LengthUsage.FontSize);break;case"shd":t["background-color"]=xmlUtil.colorAttr(s,"fill",null,autos.shd);break;case"highlight":t["background-color"]=xmlUtil.colorAttr(s,"val",null,autos.highlight);break;case"vertAlign":break;case"position":t.verticalAlign=globalXmlParser.lengthAttr(s,"val",LengthUsage.FontSize);break;case"tcW":if(this.options.ignoreWidth)break;case"tblW":t.width=values.valueOfSize(s,"w");break;case"trHeight":this.parseTrHeight(s,t);break;case"strike":t["text-decoration"]=globalXmlParser.boolAttr(s,"val",!0)?"line-through":"none";break;case"b":t["font-weight"]=globalXmlParser.boolAttr(s,"val",!0)?"bold":"normal";break;case"i":t["font-style"]=globalXmlParser.boolAttr(s,"val",!0)?"italic":"normal";break;case"caps":t["text-transform"]=globalXmlParser.boolAttr(s,"val",!0)?"uppercase":"none";break;case"smallCaps":t["font-variant"]=globalXmlParser.boolAttr(s,"val",!0)?"small-caps":"none";break;case"u":this.parseUnderline(s,t);break;case"ind":case"tblInd":this.parseIndentation(s,t);break;case"rFonts":this.parseFont(s,t);break;case"tblBorders":this.parseBorderProperties(s,r||t);break;case"tblCellSpacing":t["border-spacing"]=values.valueOfMargin(s),t["border-collapse"]="separate";break;case"pBdr":case"tcBorders":this.parseBorderProperties(s,t);break;case"bdr":t.border=values.valueOfBorder(s);break;case"vanish":globalXmlParser.boolAttr(s,"val",!0)&&(t.display="none");break;case"kern":case"noWrap":case"bCs":case"iCs":case"szCs":case"tabs":case"outlineLvl":case"contextualSpacing":case"tblStyleColBandSize":case"tblStyleRowBandSize":case"webHidden":case"pageBreakBefore":case"suppressLineNumbers":case"keepLines":case"keepNext":case"widowControl":case"bidi":case"rtl":case"noProof":break;case"tblCellMar":case"tcMar":this.parseMarginProperties(s,r||t);break;case"tblLayout":t["table-layout"]=values.valueOfTblLayout(s);break;case"vAlign":t["vertical-align"]=values.valueOfTextAlignment(s);break;case"spacing":"pPr"==e.localName&&this.parseSpacing(s,t);break;case"wordWrap":globalXmlParser.boolAttr(s,"val")&&(t["overflow-wrap"]="break-word");break;case"suppressAutoHyphens":t.hyphens=globalXmlParser.boolAttr(s,"val",!0)?"none":"auto";break;case"lang":t.$lang=globalXmlParser.attr(s,"val");break;default:this.options.debug&&console.warn(`DOCX: Unknown document element: ${e.localName}.${s.localName}`)}}),t}parseUnderline(e,t){var r=globalXmlParser.attr(e,"val");if(null!=r){switch(r){case"dash":case"dashDotDotHeavy":case"dashDotHeavy":case"dashedHeavy":case"dashLong":case"dashLongHeavy":case"dotDash":case"dotDotDash":t["text-decoration"]="underline dashed";break;case"dotted":case"dottedHeavy":t["text-decoration"]="underline dotted";break;case"double":t["text-decoration"]="underline double";break;case"single":case"thick":case"words":t["text-decoration"]="underline";break;case"wave":case"wavyDouble":case"wavyHeavy":t["text-decoration"]="underline wavy";break;case"none":t["text-decoration"]="none"}var a=xmlUtil.colorAttr(e,"color");a&&(t["text-decoration-color"]=a)}}parseFont(e,t){var r=globalXmlParser.attr(e,"ascii"),a=values.themeValue(e,"asciiTheme"),s=[r,a].filter(e=>e).join(", ");s.length>0&&(t["font-family"]=s)}parseIndentation(e,t){var r=globalXmlParser.lengthAttr(e,"firstLine"),a=globalXmlParser.lengthAttr(e,"hanging"),s=globalXmlParser.lengthAttr(e,"left"),l=globalXmlParser.lengthAttr(e,"start"),n=globalXmlParser.lengthAttr(e,"right"),o=globalXmlParser.lengthAttr(e,"end");r&&(t["text-indent"]=r),a&&(t["text-indent"]=`-${a}`),(s||l)&&(t["margin-left"]=s||l),(n||o)&&(t["margin-right"]=n||o)}parseSpacing(e,t){var r=globalXmlParser.lengthAttr(e,"before"),a=globalXmlParser.lengthAttr(e,"after"),s=globalXmlParser.intAttr(e,"line",null),l=globalXmlParser.attr(e,"lineRule");if(r&&(t["margin-top"]=r),a&&(t["margin-bottom"]=a),null!==s)switch(l){case"auto":t["line-height"]=`${(s/240).toFixed(2)}`;break;case"atLeast":t["line-height"]=`calc(100% + ${s/20}pt)`;break;default:t["line-height"]=t["min-height"]=`${s/20}pt`}}parseMarginProperties(e,t){xmlUtil.foreach(e,e=>{switch(e.localName){case"left":t["padding-left"]=values.valueOfMargin(e);break;case"right":t["padding-right"]=values.valueOfMargin(e);break;case"top":t["padding-top"]=values.valueOfMargin(e);break;case"bottom":t["padding-bottom"]=values.valueOfMargin(e)}})}parseTrHeight(e,t){globalXmlParser.attr(e,"hRule"),t.height=globalXmlParser.lengthAttr(e,"val")}parseBorderProperties(e,t){xmlUtil.foreach(e,e=>{switch(e.localName){case"start":case"left":t["border-left"]=values.valueOfBorder(e);break;case"end":case"right":t["border-right"]=values.valueOfBorder(e);break;case"top":t["border-top"]=values.valueOfBorder(e);break;case"bottom":t["border-bottom"]=values.valueOfBorder(e)}})}}let knownColors=["black","blue","cyan","darkBlue","darkCyan","darkGray","darkGreen","darkMagenta","darkRed","darkYellow","green","lightGray","magenta","none","red","white","yellow"];class xmlUtil{static foreach(e,t){for(var r=0;r<e.childNodes.length;r++){let a=e.childNodes[r];a.nodeType==Node.ELEMENT_NODE&&t(a)}}static colorAttr(e,t,r=null,a="black"){var s=globalXmlParser.attr(e,t);if(s)return"auto"==s?a:knownColors.includes(s)?s:`#${s}`;var l=globalXmlParser.attr(e,"themeColor");return l?`var(--docx-${l}-color)`:r}static sizeValue(e,t=LengthUsage.Dxa){return convertLength(e.textContent,t)}}class values{static themeValue(e,t){var r=globalXmlParser.attr(e,t);return r?`var(--docx-${r}-font)`:null}static valueOfSize(e,t){var r=LengthUsage.Dxa;switch(globalXmlParser.attr(e,"type")){case"dxa":break;case"pct":r=LengthUsage.Percent;break;case"auto":return"auto"}return globalXmlParser.lengthAttr(e,t,r)}static valueOfMargin(e){return globalXmlParser.lengthAttr(e,"w")}static valueOfBorder(e){if("nil"==globalXmlParser.attr(e,"val"))return"none";var t=xmlUtil.colorAttr(e,"color");return`${globalXmlParser.lengthAttr(e,"sz",LengthUsage.Border)} solid ${"auto"==t?autos.borderColor:t}`}static valueOfTblLayout(e){return"fixed"==globalXmlParser.attr(e,"val")?"fixed":"auto"}static classNameOfCnfStyle(e){let t=globalXmlParser.attr(e,"val");return["first-row","last-row","first-col","last-col","odd-col","even-col","odd-row","even-row","ne-cell","nw-cell","se-cell","sw-cell"].filter((e,r)=>"1"==t[r]).join(" ")}static valueOfJc(e){var t=globalXmlParser.attr(e,"val");switch(t){case"start":case"left":return"left";case"center":return"center";case"end":case"right":return"right";case"both":return"justify"}return t}static valueOfVertAlign(e,t=!1){var r=globalXmlParser.attr(e,"val");switch(r){case"subscript":return"sub";case"superscript":return t?"sup":"super"}return t?null:r}static valueOfTextAlignment(e){var t=globalXmlParser.attr(e,"val");switch(t){case"auto":case"baseline":return"baseline";case"top":return"top";case"center":return"middle";case"bottom":return"bottom"}return t}static addSize(e,t){return null==e?t:null==t?e:`calc(${e} + ${t})`}static classNameOftblLook(e){let t=globalXmlParser.hexAttr(e,"val",0),r="";return(globalXmlParser.boolAttr(e,"firstRow")||32&t)&&(r+=" first-row"),(globalXmlParser.boolAttr(e,"lastRow")||64&t)&&(r+=" last-row"),(globalXmlParser.boolAttr(e,"firstColumn")||128&t)&&(r+=" first-col"),(globalXmlParser.boolAttr(e,"lastColumn")||256&t)&&(r+=" last-col"),(globalXmlParser.boolAttr(e,"noHBand")||512&t)&&(r+=" no-hband"),(globalXmlParser.boolAttr(e,"noVBand")||1024&t)&&(r+=" no-vband"),r.trim()}}let defaultTab={pos:0,leader:"none",style:"left"},maxTabs=50;function computePixelToPoint(e=document.body){let t=document.createElement("div");t.style.width="100pt",e.appendChild(t);let r=100/t.offsetWidth;return e.removeChild(t),r}function updateTabStop(e,t,r,a=.75){let s=e.closest("p"),l=e.getBoundingClientRect(),n=s.getBoundingClientRect(),o=getComputedStyle(s),i=t?.length>0?t.map(e=>({pos:lengthToPoint(e.position),leader:e.leader,style:e.style})).sort((e,t)=>e.pos-t.pos):[defaultTab],c=i[i.length-1],m=n.width*a,p=lengthToPoint(r),h=c.pos+p;if(h<m)for(;h<m&&i.length<50;h+=p)i.push({...defaultTab,pos:h});let u=parseFloat(o.marginLeft),d=n.left+u,g=(l.left-d)*a,b=i.find(e=>"clear"!=e.style&&e.pos>g);if(null==b)return;let f=1;if("right"==b.style||"center"==b.style){let y=Array.from(s.querySelectorAll(`.${e.className}`)),P=y.indexOf(e)+1,k=document.createRange();k.setStart(e,1),P<y.length?k.setEndBefore(y[P]):k.setEndAfter(s);let v="center"==b.style?.5:1,S=k.getBoundingClientRect(),T=S.left+v*S.width-(n.left-u);f=b.pos-T*a}else f=b.pos-g;switch(e.innerHTML="&nbsp;",e.style.textDecoration="inherit",e.style.wordSpacing=`${f.toFixed(0)}pt`,b.leader){case"dot":case"middleDot":e.style.textDecoration="underline",e.style.textDecorationStyle="dotted";break;case"hyphen":case"heavy":case"underscore":e.style.textDecoration="underline"}}function lengthToPoint(e){return parseFloat(e)}let ns={svg:"http://www.w3.org/2000/svg",mathML:"http://www.w3.org/1998/Math/MathML"};class HtmlRenderer{constructor(e){this.htmlDocument=e,this.className="docx",this.styleMap={},this.currentPart=null,this.tableVerticalMerges=[],this.currentVerticalMerge=null,this.tableCellPositions=[],this.currentCellPosition=null,this.footnoteMap={},this.endnoteMap={},this.currentEndnoteIds=[],this.usedHederFooterParts=[],this.currentTabs=[],this.tabsTimeout=0,this.tasks=[],this.createElement=createElement}render(e,t,r=null,a){this.document=e,this.options=a,this.className=a.className,this.rootSelector=a.inWrapper?`.${this.className}-wrapper`:":root",this.styleMap=null,this.tasks=[],removeAllElements(r=r||t),removeAllElements(t),appendComment(r,"docxjs library predefined styles"),r.appendChild(this.renderDefaultStyle()),e.themePart&&(appendComment(r,"docxjs document theme values"),this.renderTheme(e.themePart,r)),null!=e.stylesPart&&(this.styleMap=this.processStyles(e.stylesPart.styles),appendComment(r,"docxjs document styles"),r.appendChild(this.renderStyles(e.stylesPart.styles))),e.numberingPart&&(this.prodessNumberings(e.numberingPart.domNumberings),appendComment(r,"docxjs document numbering styles"),r.appendChild(this.renderNumbering(e.numberingPart.domNumberings,r))),e.footnotesPart&&(this.footnoteMap=keyBy(e.footnotesPart.notes,e=>e.id)),e.endnotesPart&&(this.endnoteMap=keyBy(e.endnotesPart.notes,e=>e.id)),e.settingsPart&&(this.defaultTabSize=e.settingsPart.settings?.defaultTabStop),!a.ignoreFonts&&e.fontTablePart&&this.renderFontTable(e.fontTablePart,r);var s=this.renderSections(e.documentPart.body);this.options.inWrapper?t.appendChild(this.renderWrapper(s)):appendChildren(t,s),this.refreshTabStops()}renderTheme(e,t){let r={},a=e.theme?.fontScheme;a&&(a.majorFont&&(r["--docx-majorHAnsi-font"]=a.majorFont.latinTypeface),a.minorFont&&(r["--docx-minorHAnsi-font"]=a.minorFont.latinTypeface));let s=e.theme?.colorScheme;if(s)for(let[l,n]of Object.entries(s.colors))r[`--docx-${l}-color`]=`#${n}`;let o=this.styleToString(`.${this.className}`,r);t.appendChild(createStyleElement(o))}renderFontTable(e,t){for(let r of e.fonts)for(let a of r.embedFontRefs)this.tasks.push(this.document.loadFont(a.id,a.key).then(e=>{let s={"font-family":r.name,src:`url(${e})`};("bold"==a.type||"boldItalic"==a.type)&&(s["font-weight"]="bold"),("italic"==a.type||"boldItalic"==a.type)&&(s["font-style"]="italic"),appendComment(t,`docxjs ${r.name} font`);let l=this.styleToString("@font-face",s);t.appendChild(createStyleElement(l)),this.refreshTabStops()}))}processStyleName(e){return e?`${this.className}_${escapeClassName(e)}`:this.className}processStyles(e){let t=keyBy(e.filter(e=>null!=e.id),e=>e.id);for(let r of e.filter(e=>e.basedOn)){var a=t[r.basedOn];if(a)for(let s of(r.paragraphProps=mergeDeep(r.paragraphProps,a.paragraphProps),r.runProps=mergeDeep(r.runProps,a.runProps),a.styles)){let l=r.styles.find(e=>e.target==s.target);l?this.copyStyleProperties(s.values,l.values):r.styles.push({...s,values:{...s.values}})}else this.options.debug&&console.warn(`Can't find base style ${r.basedOn}`)}for(let n of e)n.cssName=this.processStyleName(n.id);return t}prodessNumberings(e){for(let t of e.filter(e=>e.pStyleName)){let r=this.findStyle(t.pStyleName);r?.paragraphProps?.numbering&&(r.paragraphProps.numbering.level=t.level)}}processElement(e){if(e.children)for(var t of e.children)t.parent=e,t.type==DomType.Table?this.processTable(t):this.processElement(t)}processTable(e){for(var t of e.children)for(var r of t.children)r.cssStyle=this.copyStyleProperties(e.cellStyle,r.cssStyle,["border-left","border-right","border-top","border-bottom","padding-left","padding-right","padding-top","padding-bottom"]),this.processElement(r)}copyStyleProperties(e,t,r=null){if(!e)return t;for(var a of(null==t&&(t={}),null==r&&(r=Object.getOwnPropertyNames(e)),r))e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(t[a]=e[a]);return t}createSection(e,t){var r=this.createElement("section",{className:e});return t&&(t.pageMargins&&(r.style.paddingLeft=t.pageMargins.left,r.style.paddingRight=t.pageMargins.right,r.style.paddingTop=t.pageMargins.top,r.style.paddingBottom=t.pageMargins.bottom),t.pageSize&&(this.options.ignoreWidth||(r.style.width=t.pageSize.width),this.options.ignoreHeight||(r.style.minHeight=t.pageSize.height)),t.columns&&t.columns.numberOfColumns&&(r.style.columnCount=`${t.columns.numberOfColumns}`,r.style.columnGap=t.columns.space,t.columns.separator&&(r.style.columnRule="1px solid black"))),r}renderSections(e){let t=[];this.processElement(e);let r=this.splitBySection(e.children),a=null;for(let s=0,l=r.length;s<l;s++){this.currentFootnoteIds=[];let n=r[s],o=n.sectProps||e.props,i=this.createSection(this.className,o);this.renderStyleValues(e.cssStyle,i),this.options.renderHeaders&&this.renderHeaderFooter(o.headerRefs,o,t.length,a!=o,i);var c=this.createElement("article");this.renderElements(n.elements,c),i.appendChild(c),this.options.renderFootnotes&&this.renderNotes(this.currentFootnoteIds,this.footnoteMap,i),this.options.renderEndnotes&&s==l-1&&this.renderNotes(this.currentEndnoteIds,this.endnoteMap,i),this.options.renderFooters&&this.renderHeaderFooter(o.footerRefs,o,t.length,a!=o,i),t.push(i),a=o}return t}renderHeaderFooter(e,t,r,a,s){if(e){var l=(t.titlePage&&a?e.find(e=>"first"==e.type):null)??(r%2==1?e.find(e=>"even"==e.type):null)??e.find(e=>"default"==e.type),n=l&&this.document.findPartByRelId(l.id,this.document.documentPart);if(n){this.currentPart=n,this.usedHederFooterParts.includes(n.path)||(this.processElement(n.rootElement),this.usedHederFooterParts.push(n.path));let[o]=this.renderElements([n.rootElement],s);t?.pageMargins&&(n.rootElement.type===DomType.Header?(o.style.marginTop=`calc(${t.pageMargins.header} - ${t.pageMargins.top})`,o.style.minHeight=`calc(${t.pageMargins.top} - ${t.pageMargins.header})`):n.rootElement.type===DomType.Footer&&(o.style.marginBottom=`calc(${t.pageMargins.footer} - ${t.pageMargins.bottom})`,o.style.minHeight=`calc(${t.pageMargins.bottom} - ${t.pageMargins.footer})`)),this.currentPart=null}}}isPageBreakElement(e){return e.type==DomType.Break&&("lastRenderedPageBreak"==e.break?!this.options.ignoreLastRenderedPageBreak:"page"==e.break)}splitBySection(e){var t={sectProps:null,elements:[]},r=[t];for(let a of e){if(a.type==DomType.Paragraph){let s=this.findStyle(a.styleName);s?.paragraphProps?.pageBreakBefore&&(t.sectProps=n,t={sectProps:null,elements:[]},r.push(t))}if(t.elements.push(a),a.type==DomType.Paragraph){let l=a;var n=l.sectionProps,o=-1,i=-1;if(this.options.breakPages&&l.children&&(o=l.children.findIndex(e=>-1!=(i=e.children?.findIndex(this.isPageBreakElement.bind(this))??-1))),(n||-1!=o)&&(t.sectProps=n,t={sectProps:null,elements:[]},r.push(t)),-1!=o){let c=l.children[o],m=i<c.children.length-1;if(o<l.children.length-1||m){var p=a.children,h={...a,children:p.slice(o)};if(a.children=p.slice(0,o),t.elements.push(h),m){let u=c.children,d={...c,children:u.slice(0,i)};a.children.push(d),c.children=u.slice(i)}}}}}let g=null;for(let b=r.length-1;b>=0;b--)null==r[b].sectProps?r[b].sectProps=g:g=r[b].sectProps;return r}renderWrapper(e){return this.createElement("div",{className:`${this.className}-wrapper`},e)}renderDefaultStyle(){var e=this.className;return createStyleElement(`
.${e}-wrapper { background: gray; padding: 30px; padding-bottom: 0px; display: flex; flex-flow: column; align-items: center; }
.${e}-wrapper>section.${e} { background: white; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); margin-bottom: 30px; }
.${e} { color: black; hyphens: auto; text-underline-position: from-font; }
section.${e} { box-sizing: border-box; display: flex; flex-flow: column nowrap; position: relative; overflow: hidden; }
section.${e}>article { margin-bottom: auto; z-index: 1; }
section.${e}>footer { z-index: 1; }
.${e} table { border-collapse: collapse; }
.${e} table td, .${e} table th { vertical-align: top; }
.${e} p { margin: 0pt; min-height: 1em; }
.${e} span { white-space: pre-wrap; overflow-wrap: break-word; }
.${e} a { color: inherit; text-decoration: inherit; }
`)}renderNumbering(e,t){var r="",a=[];for(var s of e){var l=`p.${this.numberingClass(s.id,s.level)}`,n="none";if(s.bullet){let o=`--${this.className}-${s.bullet.src}`.toLowerCase();r+=this.styleToString(`${l}:before`,{content:"' '",display:"inline-block",background:`var(${o})`},s.bullet.style),this.tasks.push(this.document.loadNumberingImage(s.bullet.src).then(e=>{var r=`${this.rootSelector} { ${o}: url(${e}) }`;t.appendChild(createStyleElement(r))}))}else if(s.levelText){let i=this.numberingCounter(s.id,s.level),c=i+" "+(s.start-1);s.level>0&&(r+=this.styleToString(`p.${this.numberingClass(s.id,s.level-1)}`,{"counter-reset":c})),a.push(c),r+=this.styleToString(`${l}:before`,{content:this.levelTextToContent(s.levelText,s.suff,s.id,this.numFormatToCssValue(s.format)),"counter-increment":i,...s.rStyle})}else n=this.numFormatToCssValue(s.format);r+=this.styleToString(l,{display:"list-item","list-style-position":"inside","list-style-type":n,...s.pStyle})}return a.length>0&&(r+=this.styleToString(this.rootSelector,{"counter-reset":a.join(" ")})),createStyleElement(r)}renderStyles(e){var t="";let r=this.styleMap,a=keyBy(e.filter(e=>e.isDefault),e=>e.target);for(let s of e){var l=s.styles;if(s.linked){var n=s.linked&&r[s.linked];n?l=l.concat(n.styles):this.options.debug&&console.warn(`Can't find linked style ${s.linked}`)}for(let o of l){var i=`${s.target??""}.${s.cssName}`;s.target!=o.target&&(i+=` ${o.target}`),a[s.target]==s&&(i=`.${this.className} ${s.target}, `+i),t+=this.styleToString(i,o.values)}}return createStyleElement(t)}renderNotes(e,t,r){var a=e.map(e=>t[e]).filter(e=>e);if(a.length>0){var s=this.createElement("ol",null,this.renderElements(a));r.appendChild(s)}}renderElement(e){switch(e.type){case DomType.Paragraph:return this.renderParagraph(e);case DomType.BookmarkStart:return this.renderBookmarkStart(e);case DomType.BookmarkEnd:break;case DomType.Run:return this.renderRun(e);case DomType.Table:return this.renderTable(e);case DomType.Row:return this.renderTableRow(e);case DomType.Cell:return this.renderTableCell(e);case DomType.Hyperlink:return this.renderHyperlink(e);case DomType.Drawing:return this.renderDrawing(e);case DomType.Image:return this.renderImage(e);case DomType.Text:case DomType.Text:return this.renderText(e);case DomType.DeletedText:return this.renderDeletedText(e);case DomType.Tab:return this.renderTab(e);case DomType.Symbol:return this.renderSymbol(e);case DomType.Break:return this.renderBreak(e);case DomType.Footer:return this.renderContainer(e,"footer");case DomType.Header:return this.renderContainer(e,"header");case DomType.Footnote:case DomType.Endnote:return this.renderContainer(e,"li");case DomType.FootnoteReference:return this.renderFootnoteReference(e);case DomType.EndnoteReference:return this.renderEndnoteReference(e);case DomType.NoBreakHyphen:return this.createElement("wbr");case DomType.VmlPicture:return this.renderVmlPicture(e);case DomType.VmlElement:return this.renderVmlElement(e);case DomType.MmlMath:return this.renderContainerNS(e,ns.mathML,"math",{xmlns:ns.mathML});case DomType.MmlMathParagraph:return this.renderContainer(e,"span");case DomType.MmlFraction:return this.renderContainerNS(e,ns.mathML,"mfrac");case DomType.MmlBase:return this.renderContainerNS(e,ns.mathML,e.parent.type==DomType.MmlMatrixRow?"mtd":"mrow");case DomType.MmlNumerator:case DomType.MmlDenominator:case DomType.MmlFunction:case DomType.MmlLimit:case DomType.MmlBox:return this.renderContainerNS(e,ns.mathML,"mrow");case DomType.MmlGroupChar:return this.renderMmlGroupChar(e);case DomType.MmlLimitLower:return this.renderContainerNS(e,ns.mathML,"munder");case DomType.MmlMatrix:return this.renderContainerNS(e,ns.mathML,"mtable");case DomType.MmlMatrixRow:return this.renderContainerNS(e,ns.mathML,"mtr");case DomType.MmlRadical:return this.renderMmlRadical(e);case DomType.MmlSuperscript:return this.renderContainerNS(e,ns.mathML,"msup");case DomType.MmlSubscript:return this.renderContainerNS(e,ns.mathML,"msub");case DomType.MmlDegree:case DomType.MmlSuperArgument:case DomType.MmlSubArgument:return this.renderContainerNS(e,ns.mathML,"mn");case DomType.MmlFunctionName:return this.renderContainerNS(e,ns.mathML,"ms");case DomType.MmlDelimiter:return this.renderMmlDelimiter(e);case DomType.MmlRun:return this.renderMmlRun(e);case DomType.MmlNary:return this.renderMmlNary(e);case DomType.MmlPreSubSuper:return this.renderMmlPreSubSuper(e);case DomType.MmlBar:return this.renderMmlBar(e);case DomType.MmlEquationArray:return this.renderMllList(e);case DomType.Inserted:return this.renderInserted(e);case DomType.Deleted:return this.renderDeleted(e)}return null}renderChildren(e,t){return this.renderElements(e.children,t)}renderElements(e,t){if(null==e)return null;var r=e.flatMap(e=>this.renderElement(e)).filter(e=>null!=e);return t&&appendChildren(t,r),r}renderContainer(e,t,r){return this.createElement(t,r,this.renderChildren(e))}renderContainerNS(e,t,r,a){return createElementNS(t,r,a,this.renderChildren(e))}renderParagraph(e){var t=this.createElement("p");let r=this.findStyle(e.styleName);e.tabs,e.tabs=r?.paragraphProps?.tabs,this.renderClass(e,t),this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),this.renderCommonProperties(t.style,e);let a=e.numbering??r?.paragraphProps?.numbering;return a&&t.classList.add(this.numberingClass(a.id,a.level)),t}renderRunProperties(e,t){this.renderCommonProperties(e,t)}renderCommonProperties(e,t){null!=t&&(t.color&&(e.color=t.color),t.fontSize&&(e["font-size"]=t.fontSize))}renderHyperlink(e){var t=this.createElement("a");if(this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),e.href)t.href=e.href;else if(e.id){let r=this.document.documentPart.rels.find(t=>t.id==e.id&&"External"===t.targetMode);t.href=r?.target}return t}renderDrawing(e){var t=this.createElement("div");return t.style.display="inline-block",t.style.position="relative",t.style.textIndent="0px",this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),t}renderImage(e){let t=this.createElement("img");return this.renderStyleValues(e.cssStyle,t),this.document&&this.tasks.push(this.document.loadDocumentImage(e.src,this.currentPart).then(e=>{t.src=e})),t}renderText(e){return this.htmlDocument.createTextNode(e.text)}renderDeletedText(e){return this.options.renderEndnotes?this.htmlDocument.createTextNode(e.text):null}renderBreak(e){return"textWrapping"==e.break?this.createElement("br"):null}renderInserted(e){return this.options.renderChanges?this.renderContainer(e,"ins"):this.renderChildren(e)}renderDeleted(e){return this.options.renderChanges?this.renderContainer(e,"del"):null}renderSymbol(e){var t=this.createElement("span");return t.style.fontFamily=e.font,t.innerHTML=`&#x${e.char};`,t}renderFootnoteReference(e){var t=this.createElement("sup");return this.currentFootnoteIds.push(e.id),t.textContent=`${this.currentFootnoteIds.length}`,t}renderEndnoteReference(e){var t=this.createElement("sup");return this.currentEndnoteIds.push(e.id),t.textContent=`${this.currentEndnoteIds.length}`,t}renderTab(e){var t=this.createElement("span");if(t.innerHTML="&emsp;",this.options.experimental){t.className=this.tabStopClass();var r=findParent(e,DomType.Paragraph)?.tabs;this.currentTabs.push({stops:r,span:t})}return t}renderBookmarkStart(e){var t=this.createElement("span");return t.id=e.name,t}renderRun(e){if(e.fieldRun)return null;let t=this.createElement("span");if(e.id&&(t.id=e.id),this.renderClass(e,t),this.renderStyleValues(e.cssStyle,t),e.verticalAlign){let r=this.createElement(e.verticalAlign);this.renderChildren(e,r),t.appendChild(r)}else this.renderChildren(e,t);return t}renderTable(e){let t=this.createElement("table");return this.tableCellPositions.push(this.currentCellPosition),this.tableVerticalMerges.push(this.currentVerticalMerge),this.currentVerticalMerge={},this.currentCellPosition={col:0,row:0},e.columns&&t.appendChild(this.renderTableColumns(e.columns)),this.renderClass(e,t),this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),this.currentVerticalMerge=this.tableVerticalMerges.pop(),this.currentCellPosition=this.tableCellPositions.pop(),t}renderTableColumns(e){let t=this.createElement("colgroup");for(let r of e){let a=this.createElement("col");r.width&&(a.style.width=r.width),t.appendChild(a)}return t}renderTableRow(e){let t=this.createElement("tr");return this.currentCellPosition.col=0,this.renderClass(e,t),this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),this.currentCellPosition.row++,t}renderTableCell(e){let t=this.createElement("td"),r=this.currentCellPosition.col;return e.verticalMerge?"restart"==e.verticalMerge?(this.currentVerticalMerge[r]=t,t.rowSpan=1):this.currentVerticalMerge[r]&&(this.currentVerticalMerge[r].rowSpan+=1,t.style.display="none"):this.currentVerticalMerge[r]=null,this.renderClass(e,t),this.renderChildren(e,t),this.renderStyleValues(e.cssStyle,t),e.span&&(t.colSpan=e.span),this.currentCellPosition.col+=t.colSpan,t}renderVmlPicture(e){var t=createElement("div");return this.renderChildren(e,t),t}renderVmlElement(e){var t=createSvgElement("svg");t.setAttribute("style",e.cssStyleText);let r=this.renderVmlChildElement(e);return e.imageHref?.id&&this.tasks.push(this.document?.loadDocumentImage(e.imageHref.id,this.currentPart).then(e=>r.setAttribute("href",e))),t.appendChild(r),requestAnimationFrame(()=>{let e=t.firstElementChild.getBBox();t.setAttribute("width",`${Math.ceil(e.x+e.width)}`),t.setAttribute("height",`${Math.ceil(e.y+e.height)}`)}),t}renderVmlChildElement(e){let t=createSvgElement(e.tagName);for(let r of(Object.entries(e.attrs).forEach(([e,r])=>t.setAttribute(e,r)),e.children))r.type==DomType.VmlElement?t.appendChild(this.renderVmlChildElement(r)):t.appendChild(...asArray(this.renderElement(r)));return t}renderMmlRadical(e){let t=e.children.find(e=>e.type==DomType.MmlBase);if(e.props?.hideDegree)return createElementNS(ns.mathML,"msqrt",null,this.renderElements([t]));let r=e.children.find(e=>e.type==DomType.MmlDegree);return createElementNS(ns.mathML,"mroot",null,this.renderElements([t,r]))}renderMmlDelimiter(e){let t=[];return t.push(createElementNS(ns.mathML,"mo",null,[e.props.beginChar??"("])),t.push(...this.renderElements(e.children)),t.push(createElementNS(ns.mathML,"mo",null,[e.props.endChar??")"])),createElementNS(ns.mathML,"mrow",null,t)}renderMmlNary(e){let t=[],r=keyBy(e.children,e=>e.type),a=r[DomType.MmlSuperArgument],s=r[DomType.MmlSubArgument],l=a?createElementNS(ns.mathML,"mo",null,asArray(this.renderElement(a))):null,n=s?createElementNS(ns.mathML,"mo",null,asArray(this.renderElement(s))):null,o=createElementNS(ns.mathML,"mo",null,[e.props?.char??""]);return l||n?t.push(createElementNS(ns.mathML,"munderover",null,[o,n,l])):l?t.push(createElementNS(ns.mathML,"mover",null,[o,l])):n?t.push(createElementNS(ns.mathML,"munder",null,[o,n])):t.push(o),t.push(...this.renderElements(r[DomType.MmlBase].children)),createElementNS(ns.mathML,"mrow",null,t)}renderMmlPreSubSuper(e){let t=[],r=keyBy(e.children,e=>e.type),a=r[DomType.MmlSuperArgument],s=r[DomType.MmlSubArgument],l=a?createElementNS(ns.mathML,"mo",null,asArray(this.renderElement(a))):null,n=s?createElementNS(ns.mathML,"mo",null,asArray(this.renderElement(s))):null,o=createElementNS(ns.mathML,"mo",null);return t.push(createElementNS(ns.mathML,"msubsup",null,[o,n,l])),t.push(...this.renderElements(r[DomType.MmlBase].children)),createElementNS(ns.mathML,"mrow",null,t)}renderMmlGroupChar(e){let t="bot"===e.props.verticalJustification?"mover":"munder",r=this.renderContainerNS(e,ns.mathML,t);return e.props.char&&r.appendChild(createElementNS(ns.mathML,"mo",null,[e.props.char])),r}renderMmlBar(e){let t=this.renderContainerNS(e,ns.mathML,"mrow");switch(e.props.position){case"top":t.style.textDecoration="overline";break;case"bottom":t.style.textDecoration="underline"}return t}renderMmlRun(e){let t=createElementNS(ns.mathML,"ms");return this.renderClass(e,t),this.renderStyleValues(e.cssStyle,t),this.renderChildren(e,t),t}renderMllList(e){let t=createElementNS(ns.mathML,"mtable");for(let r of(this.renderClass(e,t),this.renderStyleValues(e.cssStyle,t),this.renderChildren(e),this.renderChildren(e)))t.appendChild(createElementNS(ns.mathML,"mtr",null,[createElementNS(ns.mathML,"mtd",null,[r])]));return t}renderStyleValues(e,t){for(let r in e)r.startsWith("$")?t.setAttribute(r.slice(1),e[r]):t.style[r]=e[r]}renderClass(e,t){e.className&&(t.className=e.className),e.styleName&&t.classList.add(this.processStyleName(e.styleName))}findStyle(e){return e&&this.styleMap?.[e]}numberingClass(e,t){return`${this.className}-num-${e}-${t}`}tabStopClass(){return`${this.className}-tab-stop`}styleToString(e,t,r=null){let a=`${e} {\r
`;for(let s in t)s.startsWith("$")||(a+=`  ${s}: ${t[s]};\r
`);return r&&(a+=r),a+"}\r\n"}numberingCounter(e,t){return`${this.className}-num-${e}-${t}`}levelTextToContent(e,t,r,a){return`"${e.replace(/%\d*/g,e=>`"counter(${this.numberingCounter(r,parseInt(e.substring(1),10)-1)}, ${a})"`)}${({tab:"\\9",space:"\\a0"})[t]??""}"`}numFormatToCssValue(e){return({none:"none",bullet:"disc",decimal:"decimal",lowerLetter:"lower-alpha",upperLetter:"upper-alpha",lowerRoman:"lower-roman",upperRoman:"upper-roman",decimalZero:"decimal-leading-zero",aiueo:"katakana",aiueoFullWidth:"katakana",chineseCounting:"simp-chinese-informal",chineseCountingThousand:"simp-chinese-informal",chineseLegalSimplified:"simp-chinese-formal",chosung:"hangul-consonant",ideographDigital:"cjk-ideographic",ideographTraditional:"cjk-heavenly-stem",ideographLegalTraditional:"trad-chinese-formal",ideographZodiac:"cjk-earthly-branch",iroha:"katakana-iroha",irohaFullWidth:"katakana-iroha",japaneseCounting:"japanese-informal",japaneseDigitalTenThousand:"cjk-decimal",japaneseLegal:"japanese-formal",thaiNumbers:"thai",koreanCounting:"korean-hangul-formal",koreanDigital:"korean-hangul-formal",koreanDigital2:"korean-hanja-informal",hebrew1:"hebrew",hebrew2:"hebrew",hindiNumbers:"devanagari",ganada:"hangul",taiwaneseCounting:"cjk-ideographic",taiwaneseCountingThousand:"cjk-ideographic",taiwaneseDigital:"cjk-decimal"})[e]??e}refreshTabStops(){this.options.experimental&&(clearTimeout(this.tabsTimeout),this.tabsTimeout=setTimeout(()=>{let e=computePixelToPoint();for(let t of this.currentTabs)updateTabStop(t.span,t.stops,this.defaultTabSize,e)},500))}}function createElement(e,t,r){return createElementNS(void 0,e,t,r)}function createSvgElement(e,t,r){return createElementNS(ns.svg,e,t,r)}function createElementNS(e,t,r,a){var s=e?document.createElementNS(e,t):document.createElement(t);return Object.assign(s,r),a&&appendChildren(s,a),s}function removeAllElements(e){e.innerHTML=""}function appendChildren(e,t){t.forEach(t=>e.appendChild(isString(t)?document.createTextNode(t):t))}function createStyleElement(e){return createElement("style",{innerHTML:e})}function appendComment(e,t){e.appendChild(document.createComment(t))}function findParent(e,t){for(var r=e.parent;null!=r&&r.type!=t;)r=r.parent;return r}let defaultOptions={ignoreHeight:!1,ignoreWidth:!1,ignoreFonts:!1,breakPages:!0,debug:!1,experimental:!1,className:"docx",inWrapper:!0,trimXmlDeclaration:!0,ignoreLastRenderedPageBreak:!0,renderHeaders:!0,renderFooters:!0,renderFootnotes:!0,renderEndnotes:!0,useBase64URL:!1,renderChanges:!1};function praseAsync(e,t){let r={...defaultOptions,...t};return WordDocument.load(e,new DocumentParser(r),r)}async function renderDocument(e,t,r,a){let s={...defaultOptions,...a},l=new HtmlRenderer(window.document);return l.render(e,t,r,s),Promise.allSettled(l.tasks.filter(e=>e))}async function renderAsync(e,t,r,a){let s=await praseAsync(e,a);return await renderDocument(s,t,r,a),s}export{defaultOptions,praseAsync,renderAsync,renderDocument};